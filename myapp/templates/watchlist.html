{% load static %}
<!DOCTYPE html>
<html>
<head>
    <title>My Watchlist</title>
    <link rel="stylesheet" type="text/css" href="{% static 'styles.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'watchlist.css' %}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&family=Caprasimo&family=League+Spartan:wght@100..900&family=Passion+One:wght@400;700;900&family=Ultra&family=Young+Serif&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Single Alpine.js include -->
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
</head>
<body>
    <main x-data="watchlistApp()">
        <nav class="navbar" 
             x-transition:enter="navbar-enter" 
             x-transition:enter-start="navbar-enter-start" 
             x-transition:enter-end="navbar-enter-end">
            <div class="logo">
                <div class="logo-icon">
                    <svg width="20" height="20" fill="white" viewBox="0 0 24 24">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 14.5v-9l6 4.5-6 4.5z"/>
                    </svg>
                </div>
                <span>Watchlist</span>
            </div>
                            <!-- Browse Menu -->
                            <div class="expandable-menu" x-data="{ open: false }">
                                <button @click="open = !open" class="expand-button">
                                    Browse <i class="fas" :class="open ? 'fa-chevron-up' : 'fa-chevron-down'"></i>
                                </button>
                                <div class="menu-items-container" x-show="open" @click.away="open = false"
                                     x-transition:enter="menu-enter" x-transition:enter-start="menu-enter-start">
                                    <!-- Media Type Switch -->
                                    <div class="menu-section">
                                    </div>
                                    <div class="menu-divider"></div>
                                    <!-- Categories -->
                                    <div class="menu-section">
                                        <a href="#" @click.prevent="navigateToCategory('popular')" class="menu-item">Popular</a>
                                        <a href="#" @click.prevent="navigateToCategory('top_rated')" class="menu-item">Top Rated</a>
                                    </div>
                                    <div class="menu-divider"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
            
                        <div class="nav-right">
                            <a href="{% url 'account' %}">Create Account / Login</a>
                            <a href="{% url 'books' %}">Books</a>
                            <a href="{% url 'shows' %}">Shows & Movies</a>
                            <a href="{% url 'animanga' %}">Anime & Manga</a>
                        </div>
        </nav>
        <div class="watchlist-container">
            <div class="watchlist-controls">
                <div class="watchlist-tabs">
                    <button @click="currentTab = 'watching'" 
                            :class="{ active: currentTab === 'watching' }">
                        Currently Watching
                    </button>
                    <button @click="currentTab = 'plan_to_watch'"
                            :class="{ active: currentTab === 'plan_to_watch' }">
                        Plan to Watch
                    </button>
                    <button @click="currentTab = 'completed'"
                            :class="{ active: currentTab === 'completed' }">
                        Completed
                    </button>
                </div>
                <div class="sort-controls">
                    <select x-model="sortBy" @change="sortItems()">
                        <option value="title">Sort by Title</option>
                        <option value="rating">Sort by Rating</option>
                        <option value="dateAdded">Sort by Date Added</option>
                    </select>
                </div>
            </div>

            <template x-for="item in filteredItems" :key="item.id">
                <div class="watchlist-item" :class="{ 'expanded': item.expanded }">
                    <img :src="item.poster_path" :alt="item.title">
                    <div class="item-info">
                        <h3 x-text="item.title"></h3>
                        <div class="progress-tracker">
                            <input type="number" x-model="item.progress" min="0" :max="item.total_episodes || 999">
                            <span>/ <span x-text="item.total_episodes || '?'"></span></span>
                        </div>
                        <div class="rating-container">
                            <template x-for="star in 5">
                                <i class="fas fa-star" 
                                   :class="{ 'active': star <= item.rating }"
                                   @click="updateRating(item, star)"></i>
                            </template>
                        </div>
                        <textarea x-model="item.notes" 
                                placeholder="Add notes..."
                                @change="updateNotes(item)"></textarea>
                        <select x-model="item.status" @change="updateStatus(item)">
                            <option value="watching">Currently Watching</option>
                            <option value="plan_to_watch">Plan to Watch</option>
                            <option value="completed">Completed</option>
                            <option value="dropped">Dropped</option>
                        </select>
                        <button class="delete-btn" @click="deleteItem(item)">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            </template>
        </div>
    </main>
    <script src="{% static 'watchlist.js' %}"></script>
</body>
</html>